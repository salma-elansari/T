function loadProfile() {
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSrz5-JmQ3GRNn-_0FCJkOY1XLtxb1lmbHSDQF_Z2H57MAIWri2LyDngSxiYIUjEQT0BBita1xtOqcF/pub?output=csv'; // Replace with your CSV link
    fetch(sheetURL)
        .then(response => response.text())
        .then(data => {
            const rows = data.split('\n').slice(1); // Skip header row
            const urlParams = new URLSearchParams(window.location.search);
            const matricule = urlParams.get('matricule'); // Get matricule from URL

            let profile = {};
            rows.forEach(row => {
                const columns = row.split(',');
                if (columns.length >= 7 && columns[3] === matricule) {
                    profile = {
                        nom: columns[0],
                        prenom: columns[1],
                        service: columns[2],
                        matricule: columns[3],
                        numTel: columns[4],
                        habilitations: columns[5].split(';'),
                        expirationDates: columns[6].split(';')
                    };
                }
            });

            if (profile.nom) {
                document.getElementById('nom').textContent = profile.nom;
                document.getElementById('prenom').textContent = profile.prenom;
                document.getElementById('service').textContent = profile.service;
                document.getElementById('matricule').textContent = profile.matricule;
                document.getElementById('numTel').textContent = profile.numTel;

                const table = document.getElementById('habilitationTable');
                profile.habilitations.forEach((habilitation, index) => {
                    const newRow = table.insertRow();
                    const cell1 = newRow.insertCell(0);
                    const cell2 = newRow.insertCell(1);
                    const cell3 = newRow.insertCell(2);

                    cell1.textContent = index + 1;
                    cell2.textContent = habilitation;
                    cell3.textContent = profile.expirationDates[index] || '';
                });
            } else {
                alert('No profile found for the given matricule.');
            }
        });
}

window.onload = loadProfile;
